@model StudentSquads.ViewModels.WorkViewModel
@{
	ViewBag.Title = "WorkEditForm";
}

<h2>Редактирование выездного списка</h2>
<button class="btn btn-warning js-change" data-id="@Model.Id">Сохранить</button>
@using (Html.BeginForm("Delete", "Works"))
{
	<button type="submit" class="btn btn-default">Удалить</button>
		@*<input type="submit" name="button2" value="Удалить" class="btn btn-default" formaction="@Url.Action("Delete", "Positions")" />*@
	@Html.HiddenFor(m => m.Id, new { @id = "Id" })
	<div class="form-group">
		@Html.LabelFor(m => m.Employer)
		@Html.TextBoxFor(m => m.Employer, new { @id = "employer", @class = "form-control" })
	</div>
	<div class="form-group">
		@Html.LabelFor(m => m.WorkProject)
		@Html.TextBoxFor(m => m.WorkProject, new { @id = "workproject", @class = "form-control" })
	</div>
	<div class="form-group">
		@Html.LabelFor(m => m.DateofBegin)
		@Html.TextBoxFor(m => m.DateofBegin, "{0:dd.MM.yyyy}", new { @id = "dateofbegin", @class = "form-control" })
	</div>
	<div class="form-group">
		@Html.LabelFor(m => m.DateofEnd)
		<div class="tt-container">
			@Html.TextBoxFor(m => m.DateofEnd, "{0:dd.MM.yyyy}", new { @id = "dateofend", @class = "form-control" })
		</div>
	</div>
	<div class="form-group">
		<label>Член отряда</label>
		<div class="tt-container">
			<input id="member" type="text" class="form-control" name="" value="" />
		</div>
	</div>
	<div class="form-group">
		@Html.LabelFor(m => m.FIO)
		@Html.TextBoxFor(m => m.FIO, new { @id = "member", @class = "form-control", @readonly = "readonly" })
	</div>
	<div class="checkbox">
		<label>
			@Html.CheckBoxFor(m => m.Alternative, new { @id = "alternative" }) Альтернативная целина?
		</label>
	</div>
}
@section scripts
{
	@Scripts.Render("~/bundles/jqueryval")
	<script>
		$(document).ready(function () {
			//Изменение
			$(".js-change").on("click", function () {
				var button = $(this);
				var vm = {};
				//vm.HeadofStudentSquadsId = button.attr("data-id");
				//vm.PersonId = document.getElementById('personId').value;
				//vm.Position = document.getElementById('position').value;
				//vm.HasRole = document.getElementById('hasrole').value;
				$.ajax({
					url: "/api/works",
					method: "post",
					data: vm
				})
					.done(function () {
						toastr.success("Успешно сохранено");
					})
					.fail(function () {
						toastr.error("Произошла ошибка сохранения");
					});

			});
			//Удаление
			$(".js-delete").on("click", function () {
				var button = $(this);
				var vm = {};
				bootbox.prompt("Вы уверены, что хотите удалить запись в выездном списке?\nУкажите причину:", function (result) {
					if (result) {
						$.ajax({
							url: "/api/works/" + button.attr("data-id") + "/" + result,
							method: "DELETE",
							success: function () {
								bootbox.alert("Запись удалена из списка.")
								window.location = "/works/allworks"
							}

						});
					}
				});
			});
		});
	</script>
}

